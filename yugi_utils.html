<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Yugi Utils - Essential tools for Yu-Gi-Oh! players">
    <meta name="theme-color" content="#111827">
    <title>Yugi Utils</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            100: '#f3f4f6',
                            200: '#e5e7eb',
                            300: '#d1d5db',
                            400: '#9ca3af',
                            500: '#6b7280',
                            600: '#4b5563',
                            700: '#374151',
                            800: '#1f2937',
                            900: '#111827',
                        }
                    },
                    animation: {
                        'flip-coin': 'flipCoin 0.5s ease-out',
                        'roll-dice': 'rollDice 0.6s ease-out',
                        'fade-in': 'fadeIn 0.3s ease-in',
                    },
                    keyframes: {
                        flipCoin: {
                            '0%': { transform: 'rotateY(0deg)' },
                            '50%': { transform: 'rotateY(180deg)' },
                            '100%': { transform: 'rotateY(0deg)' },
                        },
                        rollDice: {
                            '0%': { transform: 'rotate(0deg) scale(1)' },
                            '50%': { transform: 'rotate(180deg) scale(0.8)' },
                            '100%': { transform: 'rotate(360deg) scale(1)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @media (max-width: 768px) {
            .tool-section {
                width: 100%;
                margin-bottom: 1rem;
            }
        }
        @media (min-width: 769px) {
            .tool-section {
                width: 48%;
                margin-bottom: 1rem;
            }
        }
        .coin {
            transition: transform 0.5s;
        }
        .dice {
            transition: transform 0.6s;
        }
        .life-points-input::-webkit-inner-spin-button,
        .life-points-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .life-points-input {
            -moz-appearance: textfield;
        }
        .chat-message {
            animation: fadeIn 0.3s ease-in;
        }
        .card-image {
            transition: transform 0.2s;
        }        .card-image:hover {
            transform: scale(1.05);
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-dark-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="flex flex-col items-center mb-8">
            <h1 class="text-4xl font-bold mb-2">Yugi Utils</h1>
            <p class="text-lg text-gray-600 dark:text-gray-400">Essential tools for Yu-Gi-Oh! players</p>
            <div class="flex items-center mt-4">
                <button id="darkModeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-dark-700">
                    <i class="fas fa-moon dark:hidden"></i>
                    <i class="fas fa-sun hidden dark:block"></i>
                </button>
                <button id="installBtn" class="ml-2 p-2 rounded-full bg-gray-200 dark:bg-dark-700 hidden">
                    <i class="fas fa-download"></i>
                </button>
            </div>
        </header>

        <main class="flex flex-col md:flex-row flex-wrap justify-between">
            <!-- Life Points Calculator -->
            <section class="tool-section bg-white dark:bg-dark-800 rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold">Life Points Calculator</h2>
                    <button id="lpToggle" class="p-2 rounded-full bg-gray-200 dark:bg-dark-700">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div id="lpContent" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Player 1 -->
                        <div class="bg-gray-100 dark:bg-dark-700 p-4 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-lg font-medium">Player 1</h3>
                                <div class="flex space-x-2">
                                    <button onclick="resetLP(1)" class="p-1 rounded bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500">
                                        <i class="fas fa-redo"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-center mb-4">
                                <input type="number" id="lp1" value="8000" class="life-points-input text-3xl font-bold w-full bg-transparent border-b-2 border-gray-300 dark:border-dark-600 focus:border-blue-500 focus:outline-none text-center">
                            </div>
                            <div class="grid grid-cols-3 gap-2 mb-2">
                                <button onclick="changeLP(1, 50)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">+50</button>
                                <button onclick="changeLP(1, 500)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">+500</button>
                                <button onclick="changeLP(1, 1000)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">+1000</button>
                            </div>
                            <div class="grid grid-cols-3 gap-2 mb-2">
                                <button onclick="changeLP(1, -50)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">-50</button>
                                <button onclick="changeLP(1, -500)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">-500</button>
                                <button onclick="changeLP(1, -1000)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">-1000</button>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="changeLP(1, -2000)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">-2000</button>
                                <button onclick="halveLP(1)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">Halve</button>
                            </div>
                        </div>

                        <!-- Player 2 -->
                        <div class="bg-gray-100 dark:bg-dark-700 p-4 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-lg font-medium">Player 2</h3>
                                <div class="flex space-x-2">
                                    <button onclick="resetLP(2)" class="p-1 rounded bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500">
                                        <i class="fas fa-redo"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-center mb-4">
                                <input type="number" id="lp2" value="8000" class="life-points-input text-3xl font-bold w-full bg-transparent border-b-2 border-gray-300 dark:border-dark-600 focus:border-blue-500 focus:outline-none text-center">
                            </div>
                            <div class="grid grid-cols-3 gap-2 mb-2">
                                <button onclick="changeLP(2, 50)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">+50</button>
                                <button onclick="changeLP(2, 500)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">+500</button>
                                <button onclick="changeLP(2, 1000)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">+1000</button>
                            </div>
                            <div class="grid grid-cols-3 gap-2 mb-2">
                                <button onclick="changeLP(2, -50)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">-50</button>
                                <button onclick="changeLP(2, -500)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">-500</button>
                                <button onclick="changeLP(2, -1000)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">-1000</button>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="changeLP(2, -2000)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">-2000</button>
                                <button onclick="halveLP(2)" class="py-2 px-1 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">Halve</button>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-center space-x-4">
                        <button onclick="resetAllLP()" class="px-4 py-2 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">
                            <i class="fas fa-redo mr-2"></i>Reset All
                        </button>
                    </div>
                </div>
            </section>

            <!-- Timer -->
            <section class="tool-section bg-white dark:bg-dark-800 rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold">Match Timer</h2>
                    <button id="timerToggle" class="p-2 rounded-full bg-gray-200 dark:bg-dark-700">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div id="timerContent" class="space-y-4">
                    <div class="flex justify-center items-center">
                        <div id="timerDisplay" class="text-5xl font-mono font-bold">15:00</div>
                    </div>
                    <div class="flex justify-center space-x-4">
                        <button id="startTimer" class="px-4 py-2 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">
                            <i class="fas fa-play mr-2"></i>Start
                        </button>
                        <button id="pauseTimer" class="px-4 py-2 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">
                            <i class="fas fa-pause mr-2"></i>Pause
                        </button>
                        <button id="resetTimer" class="px-4 py-2 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">
                            <i class="fas fa-redo mr-2"></i>Reset
                        </button>
                    </div>
                    <div class="flex justify-center items-center space-x-2">
                        <span>Set Time:</span>
                        <input type="number" id="minutesInput" min="1" max="60" value="15" class="w-16 p-1 border rounded bg-gray-100 dark:bg-dark-700">
                        <span>minutes</span>
                    </div>
                </div>
            </section>

            <!-- Dice Roller -->
            <section class="tool-section bg-white dark:bg-dark-800 rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold">Dice Roller</h2>
                    <button id="diceToggle" class="p-2 rounded-full bg-gray-200 dark:bg-dark-700">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div id="diceContent" class="space-y-4">
                    <div class="flex flex-wrap justify-center items-center gap-4" id="diceResults">
                        <div class="dice w-16 h-16 bg-gray-200 dark:bg-dark-600 rounded-lg flex justify-center items-center text-2xl font-bold">
                            1
                        </div>
                    </div>
                    <div class="flex justify-center space-x-4">
                        <button id="rollDice" class="px-4 py-2 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">
                            <i class="fas fa-dice mr-2"></i>Roll
                        </button>
                        <div class="flex items-center space-x-2">
                            <span>Number:</span>
                            <input type="number" id="diceCount" min="1" max="10" value="1" class="w-16 p-1 border rounded bg-gray-100 dark:bg-dark-700">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Coin Flip -->
            <section class="tool-section bg-white dark:bg-dark-800 rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold">Coin Flip</h2>
                    <button id="coinToggle" class="p-2 rounded-full bg-gray-200 dark:bg-dark-700">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div id="coinContent" class="space-y-4">
                    <div class="flex flex-wrap justify-center items-center gap-4" id="coinResults">
                        <div class="coin w-16 h-16 bg-gray-200 dark:bg-dark-600 rounded-full flex justify-center items-center text-2xl">
                            <i class="fas fa-circle"></i>
                        </div>
                    </div>
                    <div class="flex justify-center space-x-4">
                        <button id="flipCoin" class="px-4 py-2 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">
                            <i class="fas fa-coins mr-2"></i>Flip
                        </button>
                        <div class="flex items-center space-x-2">
                            <span>Number:</span>
                            <input type="number" id="coinCount" min="1" max="10" value="1" class="w-16 p-1 border rounded bg-gray-100 dark:bg-dark-700">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Card Database -->
            <section class="tool-section bg-white dark:bg-dark-800 rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold">Card Database</h2>
                    <button id="cardToggle" class="p-2 rounded-full bg-gray-200 dark:bg-dark-700">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div id="cardContent" class="space-y-4 hidden">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="w-full md:w-1/4">
                            <div class="mb-4">
                                <label class="block mb-2">Language</label>
                                <select id="cardLanguage" class="w-full p-2 border rounded bg-gray-100 dark:bg-dark-700">
                                    <option value="en">English</option>
                                    <option value="fr">Français</option>
                                    <option value="de">Deutsch</option>
                                    <option value="it">Italiano</option>
                                    <option value="pt">Português</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block mb-2">Search</label>
                                <input type="text" id="cardSearch" placeholder="Card name..." class="w-full p-2 border rounded bg-gray-100 dark:bg-dark-700">
                            </div>
                            <div class="mb-4">
                                <label class="block mb-2">Type</label>
                                <select id="cardType" class="w-full p-2 border rounded bg-gray-100 dark:bg-dark-700">
                                    <option value="">All Types</option>
                                    <optgroup label="Main Deck">
                                        <option value="Effect Monster">Effect Monster</option>
                                        <option value="Flip Effect Monster">Flip Effect Monster</option>
                                        <option value="Normal Monster">Normal Monster</option>
                                        <option value="Ritual Monster">Ritual Monster</option>
                                        <option value="Spell Card">Spell Card</option>
                                        <option value="Trap Card">Trap Card</option>
                                    </optgroup>
                                    <optgroup label="Extra Deck">
                                        <option value="Fusion Monster">Fusion Monster</option>
                                        <option value="Link Monster">Link Monster</option>
                                        <option value="Synchro Monster">Synchro Monster</option>
                                        <option value="XYZ Monster">XYZ Monster</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block mb-2">Race (Card Type)</label>
                                <select id="cardRace" class="w-full p-2 border rounded bg-gray-100 dark:bg-dark-700">
                                    <option value="">All Races</option>
                                    <optgroup label="Monster Types">
                                        <option value="Aqua">Aqua</option>
                                        <option value="Beast">Beast</option>
                                        <option value="Beast-Warrior">Beast-Warrior</option>
                                        <option value="Cyberse">Cyberse</option>
                                        <option value="Dragon">Dragon</option>
                                        <option value="Fairy">Fairy</option>
                                        <option value="Fiend">Fiend</option>
                                        <option value="Machine">Machine</option>
                                        <option value="Spellcaster">Spellcaster</option>
                                        <option value="Warrior">Warrior</option>
                                        <option value="Zombie">Zombie</option>
                                    </optgroup>
                                    <optgroup label="Spell Types">
                                        <option value="Normal">Normal</option>
                                        <option value="Field">Field</option>
                                        <option value="Equip">Equip</option>
                                        <option value="Continuous">Continuous</option>
                                        <option value="Quick-Play">Quick-Play</option>
                                        <option value="Ritual">Ritual</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block mb-2">Attribute</label>
                                <select id="cardAttribute" class="w-full p-2 border rounded bg-gray-100 dark:bg-dark-700">
                                    <option value="">All Attributes</option>
                                    <option value="DARK">DARK</option>
                                    <option value="DIVINE">DIVINE</option>
                                    <option value="EARTH">EARTH</option>
                                    <option value="FIRE">FIRE</option>
                                    <option value="LIGHT">LIGHT</option>
                                    <option value="WATER">WATER</option>
                                    <option value="WIND">WIND</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block mb-2">Sort By</label>
                                <select id="sortBy" class="w-full p-2 border rounded bg-gray-100 dark:bg-dark-700">
                                    <option value="name">Name</option>
                                    <option value="atk">ATK</option>
                                    <option value="def">DEF</option>
                                    <option value="level">Level</option>
                                    <option value="new">Newest</option>
                                </select>
                            </div>
                            <button id="searchCards" class="w-full p-2 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded">
                                <i class="fas fa-search mr-2"></i>Search
                            </button>
                        </div>
                        <div class="w-full md:w-3/4">
                            <div id="cardResults" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                <div class="text-center">Search for cards to display results</div>
                            </div>
                            <div id="cardPagination" class="flex justify-center mt-4 hidden">
                                <button id="prevPage" class="px-4 py-2 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded-l">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <div class="px-4 py-2 bg-gray-100 dark:bg-dark-700">
                                    <span id="currentPage">1</span>/<span id="totalPages">1</span>
                                </div>
                                <button id="nextPage" class="px-4 py-2 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded-r">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Judge AI Chat -->
            <section class="tool-section bg-white dark:bg-dark-800 rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold">Judge AI Chat</h2>
                    <button id="chatToggle" class="p-2 rounded-full bg-gray-200 dark:bg-dark-700">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div id="chatContent" class="space-y-4 hidden">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="w-full md:w-1/4">
                            <div class="mb-4">
                                <label class="block mb-2">Search Cards</label>
                                <input type="text" id="chatCardSearch" placeholder="Card name..." class="w-full p-2 border rounded bg-gray-100 dark:bg-dark-700">
                            </div>
                            <div id="chatCardResults" class="h-64 overflow-y-auto bg-gray-100 dark:bg-dark-700 rounded p-2">
                                <div class="text-center text-gray-500 dark:text-gray-400">Search for cards to add to your question</div>
                            </div>
                        </div>
                        <div class="w-full md:w-3/4">                            <div id="chatMessages" class="h-[500px] overflow-y-auto bg-gray-100 dark:bg-dark-700 rounded p-4 mb-4">
                                <div class="text-center text-gray-500 dark:text-gray-400">Ask the AI judge a question about Yu-Gi-Oh! rules</div>
                            </div>
                            <div class="flex">
                                <input type="text" id="chatInput" placeholder="Ask a ruling question..." class="flex-grow p-2 border rounded-l bg-gray-100 dark:bg-dark-700">
                                <button id="sendChat" class="px-4 py-2 bg-gray-200 dark:bg-dark-600 hover:bg-gray-300 dark:hover:bg-dark-500 rounded-r">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                            <div id="chatError" class="text-red-500 dark:text-red-400 mt-2 hidden"></div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="mt-12 text-center text-gray-600 dark:text-gray-400">
            <p>Yugi Utils &copy; 2023 - All Yu-Gi-Oh! content is property of Konami</p>
        </footer>
    </div>

    <script>
        // Life Points Functions
        function changeLP(player, amount) {
            const lpInput = document.getElementById(`lp${player}`);
            let currentLP = parseInt(lpInput.value) || 0;
            currentLP += amount;
            if (currentLP < 0) currentLP = 0;
            lpInput.value = currentLP;
            saveToLocalStorage();
        }

        function halveLP(player) {
            const lpInput = document.getElementById(`lp${player}`);
            let currentLP = parseInt(lpInput.value) || 0;
            currentLP = Math.floor(currentLP / 2);
            lpInput.value = currentLP;
            saveToLocalStorage();
        }

        function resetLP(player) {
            document.getElementById(`lp${player}`).value = 8000;
            saveToLocalStorage();
        }

        function resetAllLP() {
            document.getElementById('lp1').value = 8000;
            document.getElementById('lp2').value = 8000;
            saveToLocalStorage();
        }

        // Timer Functions
        let timerInterval;
        let timerSeconds = 15 * 60;
        let isTimerRunning = false;

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            if (!isTimerRunning) {
                isTimerRunning = true;
                timerInterval = setInterval(() => {
                    if (timerSeconds > 0) {
                        timerSeconds--;
                        updateTimerDisplay();
                    } else {
                        clearInterval(timerInterval);
                        isTimerRunning = false;
                        document.getElementById('timerDisplay').classList.add('text-red-500');
                    }
                }, 1000);
            }
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;
            const minutes = parseInt(document.getElementById('minutesInput').value) || 15;
            timerSeconds = minutes * 60;
            updateTimerDisplay();
            document.getElementById('timerDisplay').classList.remove('text-red-500');
        }

        // Dice Roller Functions
        function rollDice() {
            const diceCount = parseInt(document.getElementById('diceCount').value) || 1;
            const diceResults = document.getElementById('diceResults');
            diceResults.innerHTML = '';
            
            for (let i = 0; i < diceCount; i++) {
                const result = Math.floor(Math.random() * 6) + 1;
                const diceElement = document.createElement('div');
                diceElement.className = 'dice w-16 h-16 bg-gray-200 dark:bg-dark-600 rounded-lg flex justify-center items-center text-2xl font-bold animate-roll-dice';
                diceElement.textContent = result;
                diceResults.appendChild(diceElement);
            }
        }

        // Coin Flip Functions
        function flipCoin() {
            const coinCount = parseInt(document.getElementById('coinCount').value) || 1;
            const coinResults = document.getElementById('coinResults');
            coinResults.innerHTML = '';
            
            for (let i = 0; i < coinCount; i++) {
                const result = Math.random() < 0.5 ? 'heads' : 'tails';
                const coinElement = document.createElement('div');
                coinElement.className = 'coin w-16 h-16 bg-gray-200 dark:bg-dark-600 rounded-full flex justify-center items-center text-2xl animate-flip-coin';
                
                if (result === 'heads') {
                    coinElement.innerHTML = '<i class="fas fa-circle"></i>';
                } else {
                    coinElement.innerHTML = '<i class="fas fa-font"></i>';
                }
                
                coinResults.appendChild(coinElement);
            }
        }

        // Card Database Functions
        let cardData = [];
        let filteredCards = [];
        let currentPage = 1;
        const cardsPerPage = 12;
        let currentLang = 'en';
        let selectedCards = new Set(); // Aggiungo Set per tracciare le carte selezionate

        async function loadCardData() {
            const searchParams = new URLSearchParams();
            if (currentLang !== 'en') {
                searchParams.append('language', currentLang);
            }
            
            try {
                const response = await fetch(`https://db.ygoprodeck.com/api/v7/cardinfo.php?${searchParams.toString()}`);
                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }
                
                const data = await response.json();
                cardData = data.data;
                return true;
            } catch (error) {
                console.error('Error loading card data:', error);
                showErrorMessage('Failed to load card database. Please try again later.');
                return false;
            }
        }

        function buildApiUrl() {
            const searchParams = new URLSearchParams();
            
            // Add language parameter
            if (currentLang !== 'en') {
                searchParams.append('language', currentLang);
            }
            
            // Add search term
            const searchTerm = document.getElementById('cardSearch').value.trim();
            if (searchTerm) {
                searchParams.append('fname', searchTerm);
            }
            
            // Add type filter
            const typeFilter = document.getElementById('cardType').value;
            if (typeFilter) {
                searchParams.append('type', typeFilter);
            }
            
            // Add race filter
            const raceFilter = document.getElementById('cardRace').value;
            if (raceFilter) {
                searchParams.append('race', raceFilter);
            }
            
            // Add attribute filter
            const attributeFilter = document.getElementById('cardAttribute').value;
            if (attributeFilter) {
                searchParams.append('attribute', attributeFilter);
            }
            
            // Add sort parameter
            const sortBy = document.getElementById('sortBy').value;
            if (sortBy) {
                searchParams.append('sort', sortBy);
            }
            
            return `https://db.ygoprodeck.com/api/v7/cardinfo.php?${searchParams.toString()}`;
        }        async function searchCards() {
            // Show loading state
            const cardResults = document.getElementById('cardResults');
            cardResults.innerHTML = `
                <div class="col-span-full text-center">
                    <div class="flex items-center justify-center space-x-2">
                        <i class="fas fa-circle-notch loading-spinner"></i>
                        <span>Searching cards...</span>
                    </div>
                </div>
            `;
            document.getElementById('cardPagination').classList.add('hidden');
            
            try {
                const apiUrl = buildApiUrl();
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }
                
                const data = await response.json();
                filteredCards = data.data || [];
                currentPage = 1;
                displayCards();
            } catch (error) {
                console.error('Error searching cards:', error);
                showErrorMessage('Error searching cards. Please try again.');
            }
        }

        function displayCards() {
            const startIndex = (currentPage - 1) * cardsPerPage;
            const endIndex = startIndex + cardsPerPage;
            const cardsToShow = filteredCards.slice(startIndex, endIndex);
            
            const cardResults = document.getElementById('cardResults');
            cardResults.innerHTML = '';
            
            if (cardsToShow.length === 0) {
                cardResults.innerHTML = '<div class="col-span-full text-center">No cards found matching your criteria</div>';
                document.getElementById('cardPagination').classList.add('hidden');
                return;
            }
            
            cardsToShow.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'bg-white dark:bg-dark-700 rounded-lg shadow overflow-hidden';
                
                const imageUrl = card.card_images?.[0]?.image_url_cropped || card.card_images?.[0]?.image_url;
                
                let cardInfo = [];
                if (card.attribute) cardInfo.push(`ATT: ${card.attribute}`);
                if (card.level) cardInfo.push(`LV: ${card.level}`);
                if (card.linkval) cardInfo.push(`LINK-${card.linkval}`);
                if (card.atk !== undefined) cardInfo.push(`ATK: ${card.atk}`);
                if (card.def !== undefined) cardInfo.push(`DEF: ${card.def}`);
                
                cardElement.innerHTML = `
                    <div class="card-image h-48 bg-gray-100 dark:bg-dark-600 flex items-center justify-center p-2">
                        ${imageUrl ? `<img src="${imageUrl}" alt="${card.name}" class="h-full object-contain">` : 
                                   '<div class="text-gray-400">No image</div>'}
                    </div>
                    <div class="p-2">
                        <h3 class="font-bold truncate" title="${card.name}">${card.name}</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">${card.type}</p>
                        <p class="text-xs text-gray-500 dark:text-gray-500">${cardInfo.join(' | ')}</p>
                    </div>
                `;
                
                cardElement.addEventListener('click', () => showCardDetails(card));
                cardResults.appendChild(cardElement);
            });
            
            // Update pagination
            const totalPages = Math.ceil(filteredCards.length / cardsPerPage);
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;
            
            const pagination = document.getElementById('cardPagination');
            if (totalPages > 1) {
                pagination.classList.remove('hidden');
            } else {
                pagination.classList.add('hidden');
            }
        }

        function showCardDetails(card) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
            
            const imageUrl = card.card_images?.[0]?.image_url;
            const prices = card.card_prices?.[0];
            const setInfo = card.card_sets?.[0];
            
            const content = document.createElement('div');
            content.className = 'bg-white dark:bg-dark-800 rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto';
            
            content.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <h2 class="text-2xl font-bold">${card.name}</h2>
                    <button class="text-gray-500 hover:text-gray-700" onclick="this.closest('.fixed').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex justify-center">
                        ${imageUrl ? `<img src="${imageUrl}" alt="${card.name}" class="max-h-96 object-contain">` : 
                                   '<div class="h-96 w-64 bg-gray-200 dark:bg-dark-600 flex items-center justify-center">No image</div>'}
                    </div>
                    <div>
                        <div class="space-y-2">
                            <p><strong>Type:</strong> ${card.type}</p>
                            ${card.race ? `<p><strong>Race:</strong> ${card.race}</p>` : ''}
                            ${card.attribute ? `<p><strong>Attribute:</strong> ${card.attribute}</p>` : ''}
                            ${card.level ? `<p><strong>Level/Rank:</strong> ${card.level}</p>` : ''}
                            ${card.linkval ? `<p><strong>Link Rating:</strong> ${card.linkval}</p>` : ''}
                            ${card.scale ? `<p><strong>Pendulum Scale:</strong> ${card.scale}</p>` : ''}
                            ${card.atk !== undefined ? `<p><strong>ATK:</strong> ${card.atk}</p>` : ''}
                            ${card.def !== undefined ? `<p><strong>DEF:</strong> ${card.def}</p>` : ''}
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="font-bold mb-2">Card Text:</h3>
                            <p class="whitespace-pre-wrap">${card.desc}</p>
                        </div>
                        
                        ${prices ? `
                            <div class="mt-4">
                                <h3 class="font-bold mb-2">Market Prices:</h3>
                                <div class="grid grid-cols-2 gap-2 text-sm">
                                    <p>TCGplayer: $${prices.tcgplayer_price}</p>
                                    <p>Cardmarket: €${prices.cardmarket_price}</p>
                                    <p>eBay: $${prices.ebay_price}</p>
                                    <p>Amazon: $${prices.amazon_price}</p>
                                </div>
                            </div>
                        ` : ''}
                        
                        ${setInfo ? `
                            <div class="mt-4">
                                <h3 class="font-bold mb-2">Set Information:</h3>
                                <p><strong>Set:</strong> ${setInfo.set_name}</p>
                                <p><strong>Code:</strong> ${setInfo.set_code}</p>
                                <p><strong>Rarity:</strong> ${setInfo.set_rarity}</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
        }

        function showErrorMessage(message) {
            const cardResults = document.getElementById('cardResults');
            cardResults.innerHTML = `<div class="col-span-full text-center text-red-500">${message}</div>`;
            document.getElementById('cardPagination').classList.add('hidden');
        }

        // Handle language change
        document.getElementById('cardLanguage').addEventListener('change', (e) => {
            currentLang = e.target.value;
            loadCardData().then(() => {
                document.getElementById('cardSearch').value = '';
                searchCards();
            });
        });

        // Judge AI Chat Functions
        let chatHistory = [];
        const OPENROUTER_API_KEY = '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';
        const BASE_PROMPT = 'devi agire come un judge ufficiale di Yu-Gi-Oh! Riceverai delle domande sul gioco, le sue regole e le interazioni tra le carte. Le tue risposte devono essere chiare, concise e corredate da spiegazioni dettagliate del processo di decisione del giudizio, includendo sempre citazioni da fonti ufficiali (ad esempio, il sito ufficiale di Yu-Gi-Oh! o le pagine ufficiali di Konami). Assicurati che ogni risposta fornisca il ragionamento alla base della decisione, indicandone il processo e citando le fonti ufficiali pertinenti.';

        async function callGeminiModel(prompt) {
            const messageContent = [
                {
                    type: "text",
                    text: `${BASE_PROMPT}\n\nQuestion: ${prompt}`
                }
            ];

            const requestBody = {
                model: "deepseek/deepseek-chat-v3-0324:free",
                messages: [
                    {
                        role: "user",
                        content: messageContent
                    }
                ]
            };

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${OPENROUTER_API_KEY}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": "https://yugiutils.com",
                        "X-Title": "Yugi Utils"
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0]?.message?.content || "I apologize, but I couldn't generate a proper response.";

            } catch (error) {
                console.error("Error calling Gemini model:", error);
                throw error;
            }
        }

        async function searchChatCards() {
            const searchTerm = document.getElementById('chatCardSearch').value.toLowerCase();
            if (!searchTerm) {
                document.getElementById('chatCardResults').innerHTML = 
                    '<div class="text-center text-gray-500 dark:text-gray-400">Search for cards to add to your question</div>';
                return;
            }
            
            try {
                const results = cardData.filter(card => 
                    card.name.toLowerCase().includes(searchTerm)
                ).slice(0, 10);
                
                const chatCardResults = document.getElementById('chatCardResults');
                chatCardResults.innerHTML = '';
                
                if (results.length === 0) {
                    chatCardResults.innerHTML = '<div class="text-center text-gray-500 dark:text-gray-400">No cards found</div>';
                    return;
                }

                results.forEach(card => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'p-2 hover:bg-gray-200 dark:hover:bg-dark-600 cursor-pointer';
                    
                    const imageUrl = card.card_images?.[0]?.image_url_cropped || card.card_images?.[0]?.image_url;
                    const isSelected = selectedCards.has(card.id);
                    
                    cardElement.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                ${imageUrl ? 
                                    `<img src="${imageUrl}" alt="${card.name}" class="h-12 w-12 object-contain">` : 
                                    '<div class="h-12 w-12 bg-gray-200 dark:bg-dark-600 flex items-center justify-center">No img</div>'
                                }
                                <div class="font-bold">${card.name}</div>
                            </div>
                            <button class="p-1 rounded-full ${isSelected ? 
                                'bg-green-500 dark:bg-green-700' : 
                                'bg-gray-300 dark:bg-dark-500'} hover:opacity-80 ml-2 flex-shrink-0">
                                <i class="fas ${isSelected ? 'fa-check' : 'fa-plus'} text-xs"></i>
                            </button>
                        </div>
                    `;
                    
                    // Aggiungi l'event listener al pulsante
                    const addButton = cardElement.querySelector('button');
                    addButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleCardSelection(card, addButton);
                    });

                    chatCardResults.appendChild(cardElement);
                });
            } catch (error) {
                console.error('Error searching cards:', error);
                chatCardResults.innerHTML = '<div class="text-center text-red-500">Error searching cards</div>';
            }
        }

        function toggleCardSelection(card, button) {
            if (selectedCards.has(card.id)) {
                // Deseleziona la carta
                selectedCards.delete(card.id);
                button.classList.remove('bg-green-500', 'dark:bg-green-700');
                button.classList.add('bg-gray-300', 'dark:bg-dark-500');
                button.querySelector('i').classList.replace('fa-check', 'fa-plus');
            } else {
                // Seleziona la carta
                selectedCards.add(card.id);
                button.classList.remove('bg-gray-300', 'dark:bg-dark-500');
                button.classList.add('bg-green-500', 'dark:bg-green-700');
                button.querySelector('i').classList.replace('fa-plus', 'fa-check');
            }
            updateSelectedCardsDisplay();
        }

        function updateSelectedCardsDisplay() {
            const chatInput = document.getElementById('chatInput');
            const selectedCardsText = Array.from(selectedCards)
                .map(cardId => {
                    const card = cardData.find(c => c.id === cardId);
                    return card ? card.name : null;
                })
                .filter(Boolean)
                .join(', ');
            
            chatInput.placeholder = selectedCardsText 
                ? `Selected cards: ${selectedCardsText}` 
                : "Ask a ruling question...";
        }        function sendChatMessage() {
            const message = document.getElementById('chatInput').value.trim();
            const selectedCardsInfo = Array.from(selectedCards)
                .map(cardId => {
                    const card = cardData.find(c => c.id === cardId);
                    return card ? `${card.name} (${card.type}): ${card.desc}` : null;
                })
                .filter(Boolean)
                .join('\n\n');

            if (!message && selectedCards.size === 0) return;
            
            const fullMessage = selectedCardsInfo 
                ? `Cards involved:\n${selectedCardsInfo}\n\nQuestion: ${message}`
                : message;

            document.getElementById('chatInput').value = '';
            document.getElementById('chatError').classList.add('hidden');
            selectedCards.clear();
            updateSelectedCardsDisplay();
            
            // Add user message to chat
            addMessageToChat('user', fullMessage);
            
            // Add thinking message
            const thinkingMessage = addMessageToChat('assistant', 'Judge AI is thinking...');
            
            // Call AI model and update chat
            callGeminiModel(fullMessage).then(response => {
                // Remove thinking message and add AI response
                if (thinkingMessage) {
                    thinkingMessage.remove();
                }
                addMessageToChat('assistant', response);
            }).catch(error => {
                if (thinkingMessage) {
                    thinkingMessage.remove();
                }
                addMessageToChat('assistant', 'Sorry, there was an error processing your request.');
                console.error('Error calling AI model:', error);
            });
        }        function addMessageToChat(role, content) {
            const chatMessages = document.getElementById('chatMessages');
            
            // Clear initial message if it exists
            if (chatMessages.children.length === 1 && 
                chatMessages.children[0].classList.contains('text-center')) {
                chatMessages.innerHTML = '';
            }
            
            const messageElement = document.createElement('div');
            messageElement.className = `chat-message mb-4 p-4 rounded-lg ${role === 'user' ? 
                'bg-blue-100 dark:bg-blue-900 ml-auto max-w-3/4' : 
                'bg-gray-200 dark:bg-dark-600 mr-auto max-w-3/4'}`;
            
            // Convert markdown-style formatting to HTML
            const formattedContent = content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline">$1</a>')
                .replace(/\n\n/g, '<br><br>')
                .replace(/\n/g, '<br>');
            
            messageElement.innerHTML = formattedContent;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Add to history and limit to last 10 messages
            chatHistory.push({role, content});
            if (chatHistory.length > 10) chatHistory.shift();
            
            // Return the message element so it can be removed later if needed
            return messageElement;
        }


        // Toggle Sections
        function setupSectionToggles() {
            const sections = [
                { id: 'lp', defaultOpen: true },
                { id: 'timer', defaultOpen: true },
                { id: 'dice', defaultOpen: true },
                { id: 'coin', defaultOpen: true },
                { id: 'card', defaultOpen: false },
                { id: 'chat', defaultOpen: false }
            ];
            
            sections.forEach(section => {
                const toggle = document.getElementById(`${section.id}Toggle`);
                const content = document.getElementById(`${section.id}Content`);
                
                // Set initial state
                if (section.defaultOpen) {
                    content.classList.remove('hidden');
                    toggle.querySelector('i').classList.replace('fa-chevron-down', 'fa-chevron-up');
                } else {
                    content.classList.add('hidden');
                }
                
                // Add click handler
                toggle.addEventListener('click', () => {
                    const isHidden = content.classList.toggle('hidden');
                    const icon = toggle.querySelector('i');
                    
                    if (isHidden) {
                        icon.classList.replace('fa-chevron-up', 'fa-chevron-down');
                    } else {
                        icon.classList.replace('fa-chevron-down', 'fa-chevron-up');
                        
                        // Load data when section is opened
                        if (section.id === 'card' && cardData.length === 0) {
                            loadCardData().then(() => searchCards());
                        }
                    }
                });
            });
        }

        // Local Storage Functions
        function saveToLocalStorage() {
            const state = {
                lp1: document.getElementById('lp1').value,
                lp2: document.getElementById('lp2').value,
                timerSeconds: timerSeconds,
                isTimerRunning: isTimerRunning,
                darkMode: document.documentElement.classList.contains('dark')
            };
            
            localStorage.setItem('yugiUtilsState', JSON.stringify(state));
        }

        function loadFromLocalStorage() {
            const savedState = localStorage.getItem('yugiUtilsState');
            if (savedState) {
                const state = JSON.parse(savedState);
                
                document.getElementById('lp1').value = state.lp1 || 8000;
                document.getElementById('lp2').value = state.lp2 || 8000;
                
                if (state.timerSeconds) {
                    timerSeconds = state.timerSeconds;
                    updateTimerDisplay();
                }
                
                if (state.isTimerRunning) {
                    startTimer();
                }
                
                if (state.darkMode) {
                    document.documentElement.classList.add('dark');
                }
            }
        }

        // Dark Mode Toggle
        function setupDarkModeToggle() {
            const darkModeToggle = document.getElementById('darkModeToggle');
            
            darkModeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                saveToLocalStorage();
            });
        }

        // PWA Installation
        function setupPWA() {
            let deferredPrompt;
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                document.getElementById('installBtn').classList.remove('hidden');
            });
            
            document.getElementById('installBtn').addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    if (outcome === 'accepted') {
                        document.getElementById('installBtn').classList.add('hidden');
                    }
                    deferredPrompt = null;
                }
            });
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Set up event listeners
            document.getElementById('startTimer').addEventListener('click', startTimer);
            document.getElementById('pauseTimer').addEventListener('click', pauseTimer);
            document.getElementById('resetTimer').addEventListener('click', resetTimer);
            document.getElementById('minutesInput').addEventListener('change', resetTimer);
            
            document.getElementById('rollDice').addEventListener('click', rollDice);
            document.getElementById('flipCoin').addEventListener('click', flipCoin);
            
            document.getElementById('searchCards').addEventListener('click', searchCards);
            document.getElementById('prevPage').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    displayCards();
                }
            });
            document.getElementById('nextPage').addEventListener('click', () => {
                const totalPages = Math.ceil(filteredCards.length / cardsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    displayCards();
                }
            });
            
            document.getElementById('chatCardSearch').addEventListener('input', searchChatCards);
            document.getElementById('sendChat').addEventListener('click', sendChatMessage);
            document.getElementById('chatInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendChatMessage();
            });
            
            // Life points input changes
            document.getElementById('lp1').addEventListener('change', saveToLocalStorage);
            document.getElementById('lp2').addEventListener('change', saveToLocalStorage);
            
            // Set up UI components
            setupSectionToggles();
            setupDarkModeToggle();
            setupPWA();
            
            // Load saved state
            loadFromLocalStorage();
            
            // Load card data (will be used when card section is opened)
            loadCardData();
        });
    </script>
</body>
</html>